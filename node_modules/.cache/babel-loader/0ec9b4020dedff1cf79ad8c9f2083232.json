{"ast":null,"code":"import _regeneratorRuntime from\"/Users/brianaking/Desktop/cleanify/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _createForOfIteratorHelper from\"/Users/brianaking/Desktop/cleanify/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"/Users/brianaking/Desktop/cleanify/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/brianaking/Desktop/cleanify/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/brianaking/Desktop/cleanify/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/brianaking/Desktop/cleanify/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/brianaking/Desktop/cleanify/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/brianaking/Desktop/cleanify/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'./CleanPlaylist.css';import SpotifyWebApi from'spotify-web-api-js';var spotifyApi=new SpotifyWebApi();var CleanPlaylist=/*#__PURE__*/function(_React$Component){_inherits(CleanPlaylist,_React$Component);var _super=_createSuper(CleanPlaylist);function CleanPlaylist(props){var _this;_classCallCheck(this,CleanPlaylist);_this=_super.call(this,props);_this.state={userId:_this.props.user,playlistName:_this.props.name,playlistId:_this.props.data,ownerId:'',buttonPressed:false,loadingData:false,newPlaylistId:'',revealUnable:false};_this.explicitTracks=[];_this.cleanTracks=[];_this.noCleanVersions=[];_this.recTracks=[];_this.timesClicked=1;_this.openPlaylist=\"\";_this.makeCleanPlaylist=_this.makeCleanPlaylist.bind(_assertThisInitialized(_this));_this.findCleanTrack=_this.findCleanTrack.bind(_assertThisInitialized(_this));_this.getRecommended=_this.getRecommended.bind(_assertThisInitialized(_this));_this.unableToAdd=_this.unableToAdd.bind(_assertThisInitialized(_this));_this.addTrack=_this.addTrack.bind(_assertThisInitialized(_this));return _this;}_createClass(CleanPlaylist,[{key:\"getTracksData\",value:function getTracksData(owner,id){var explicitTracksList=[];var cleanTracksList=[];spotifyApi.getPlaylistTracks(owner,id).then(function(response){// console.log(response)\nresponse.items.map(function(item){if(item.track.explicit===true){explicitTracksList.push(item.track);}else{cleanTracksList.push(item.track);}});});this.explicitTracks=explicitTracksList;this.cleanTracks=cleanTracksList;}},{key:\"componentDidMount\",value:function componentDidMount(){var playlistId=this.props.data;var ownerId=this.props.id;this.getTracksData(ownerId,playlistId);}},{key:\"findCleanTrack\",value:function(){var _findCleanTrack=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(track){var name,artist,cleanTrack,itemC,counter,searchResult,_iterator,_step;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:name=track.name;artist=track.artists[0].name;counter=0;_context.next=5;return spotifyApi.search('track:'+'\"'+name+'\"'+' artist:'+'\"'+artist+'\"',['track']);case 5:searchResult=_context.sent;// console.log(searchResult)\n_iterator=_createForOfIteratorHelper(searchResult.tracks.items);try{for(_iterator.s();!(_step=_iterator.n()).done;){itemC=_step.value;if(itemC.explicit===false){if((itemC.name===name||itemC.name.includes(\"Clean\"))&&itemC.artists[0].name===artist&&counter<=0){cleanTrack=itemC;counter++;}}}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(counter===0){cleanTrack=null;}return _context.abrupt(\"return\",cleanTrack);case 10:case\"end\":return _context.stop();}}},_callee);}));function findCleanTrack(_x){return _findCleanTrack.apply(this,arguments);}return findCleanTrack;}()},{key:\"makeCleanPlaylist\",value:function(){var _makeCleanPlaylist=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var itemE,_iterator2,_step2,cleanTrack,trackUri,newId,x,_iterator3,_step3,playlistResult,addResult;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.setState({loadingData:true});_iterator2=_createForOfIteratorHelper(this.explicitTracks);_context2.prev=2;_iterator2.s();case 4:if((_step2=_iterator2.n()).done){_context2.next=12;break;}itemE=_step2.value;_context2.next=8;return this.findCleanTrack(itemE);case 8:cleanTrack=_context2.sent;// console.log(cleanTrack)\nif(cleanTrack===null){// console.log(\"couldn't add: \" + itemE.name)\nthis.noCleanVersions.push(itemE);}else{this.cleanTracks.push(cleanTrack);// console.log(\" ADDED: \" + cleanTrack.name)\n}case 10:_context2.next=4;break;case 12:_context2.next=17;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](2);_iterator2.e(_context2.t0);case 17:_context2.prev=17;_iterator2.f();return _context2.finish(17);case 20:if(!(this.noCleanVersions.length>0)){_context2.next=24;break;}_context2.next=23;return this.getRecommended(this.noCleanVersions);case 23:this.recTracks=_context2.sent;case 24:trackUri=[];newId='';_iterator3=_createForOfIteratorHelper(this.cleanTracks);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){x=_step3.value;trackUri.push(x.uri);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}_context2.next=30;return spotifyApi.createPlaylist(this.state.userId,{name:this.state.playlistName+\"(Clean)\"});case 30:playlistResult=_context2.sent;// console.log(playlistResult)\nthis.openPlaylist=playlistResult.external_urls.spotify;newId=playlistResult.id;_context2.next=35;return spotifyApi.addTracksToPlaylist(this.state.userId,newId,trackUri);case 35:addResult=_context2.sent;// console.log(addResult)\nthis.setState({newPlaylistId:newId,buttonPressed:true});case 37:case\"end\":return _context2.stop();}}},_callee2,this,[[2,14,17,20]]);}));function makeCleanPlaylist(){return _makeCleanPlaylist.apply(this,arguments);}return makeCleanPlaylist;}()},{key:\"getRecommended\",value:function(){var _getRecommended=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(tracks){var trackId,tracksList,recTracks,recommededResult,itemR,_iterator4,_step4,cleanTrack;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:trackId=[];tracksList=tracks.slice();recTracks=[];if(tracks.length>5){tracksList.splice(5,tracks.length);}tracksList.map(function(item){trackId.push(item.id);});_context3.next=7;return spotifyApi.getRecommendations({limit:20,seed_tracks:trackId});case 7:recommededResult=_context3.sent;_iterator4=_createForOfIteratorHelper(recommededResult.tracks);_context3.prev=9;_iterator4.s();case 11:if((_step4=_iterator4.n()).done){_context3.next=23;break;}itemR=_step4.value;if(!(itemR.explicit===true)){_context3.next=20;break;}_context3.next=16;return this.findCleanTrack(itemR);case 16:cleanTrack=_context3.sent;// console.log(cleanTrack)\nif(cleanTrack!==null){recTracks.push(cleanTrack);}_context3.next=21;break;case 20:recTracks.push(itemR);case 21:_context3.next=11;break;case 23:_context3.next=28;break;case 25:_context3.prev=25;_context3.t0=_context3[\"catch\"](9);_iterator4.e(_context3.t0);case 28:_context3.prev=28;_iterator4.f();return _context3.finish(28);case 31:if(recTracks.length>10){recTracks=recTracks.slice(0,10);}return _context3.abrupt(\"return\",recTracks);case 33:case\"end\":return _context3.stop();}}},_callee3,this,[[9,25,28,31]]);}));function getRecommended(_x2){return _getRecommended.apply(this,arguments);}return getRecommended;}()},{key:\"unableToAdd\",value:function unableToAdd(){this.timesClicked++;if(this.timesClicked%2===0){this.setState({revealUnable:true});}else{this.setState({revealUnable:false});}}},{key:\"addTrack\",value:function(){var _addTrack=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(uri){var addResult;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return spotifyApi.addTracksToPlaylist(this.state.userId,this.state.newPlaylistId,[uri]);case 2:addResult=_context4.sent;case 3:case\"end\":return _context4.stop();}}},_callee4,this);}));function addTrack(_x3){return _addTrack.apply(this,arguments);}return addTrack;}()},{key:\"render\",value:function render(){var unavalible=this.noCleanVersions.map(function(item,index){index++;return/*#__PURE__*/React.createElement(\"p\",{key:item.id},\" \",index,\". \",item.name);});var recommendedTracks=this.recTracks.map(function(item){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",{key:item.id},/*#__PURE__*/React.createElement(\"div\",{className:\"row my-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col\"},/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"btn btn-add\",onClick:function onClick(){return _this2.addTrack(item.uri);}},\" ADD \")),/*#__PURE__*/React.createElement(\"div\",{className:\"col-10\"},/*#__PURE__*/React.createElement(\"iframe\",{src:\"https://open.spotify.com/embed/track/\"+item.id,width:\"90%\",height:\"80\",frameBorder:\"0\",allowtransparency:\"true\",allow:\"encrypted-media\",title:\"embeded-track\"}))));},this);return/*#__PURE__*/React.createElement(\"div\",{className:\"Clean\"},this.state.buttonPressed?/*#__PURE__*/React.createElement(\"div\",{className:\"mx-auto\"},/*#__PURE__*/React.createElement(\"h3\",{className:\"font-weight-bold text-success\"},\" Your Playlist Is Cleanified! \"),/*#__PURE__*/React.createElement(\"p\",null,\" You're done! We have already saved it to your library!\"),/*#__PURE__*/React.createElement(\"a\",{href:this.openPlaylist,target:\"_blank\",className:\"btn btn-success\"},\" Open In Spotify \"),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col\"},/*#__PURE__*/React.createElement(\"iframe\",{src:\"https://open.spotify.com/embed/playlist/\"+this.state.playlistId,width:\"80%\",height:\"400\",frameBorder:\"0\",allowtransparency:\"true\",allow:\"encrypted-media\",title:\"embeded-playlist\"})),/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-arrow-right text-success fa-2x\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"col\"},/*#__PURE__*/React.createElement(\"iframe\",{src:\"https://open.spotify.com/embed/playlist/\"+this.state.newPlaylistId,width:\"80%\",height:\"400\",frameBorder:\"0\",allowtransparency:\"true\",allow:\"encrypted-media\",title:\"embeded-playlist\"}))),/*#__PURE__*/React.createElement(\"hr\",{className:\"divider mb-5\"}),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"btn btn-danger\",onClick:this.unableToAdd},\" Reveal Songs Unable to be Cleaned: \",this.noCleanVersions.length),this.state.revealUnable&&this.noCleanVersions.length>0?unavalible:this.state.revealUnable&&/*#__PURE__*/React.createElement(\"p\",null,\"Good News! We were able to find clean versions of each song!\"),this.noCleanVersions.length>0&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"hr\",{className:\"divider mt-5\"}),/*#__PURE__*/React.createElement(\"h2\",null,\"Recommended Clean Songs\"),/*#__PURE__*/React.createElement(\"p\",null,\"Based on the songs we were unable to add: \"),recommendedTracks))):/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"btn btn-lg btn-success\",onClick:this.makeCleanPlaylist,disabled:this.state.loadingData},this.state.loadingData&&/*#__PURE__*/React.createElement(\"i\",{class:\"fa fa-compact-disc fa-spin text-white\"}),\"Clean Playlist\"),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"iframe\",{src:\"https://open.spotify.com/embed/playlist/\"+this.state.playlistId,width:\"80%\",height:\"500\",frameBorder:\"0\",allowtransparency:\"true\",allow:\"encrypted-media\",title:\"embeded-playlist\"})),/*#__PURE__*/React.createElement(\"p\",{className:\"text-muted\"},\" Note: Spotify's explicit content tags are applied based on information Spotify receives from rights-holders. They can\\u2019t guarantee all explicit content is marked as such.\")));}}]);return CleanPlaylist;}(React.Component);export default CleanPlaylist;","map":{"version":3,"sources":["/Users/brianaking/Desktop/cleanify/client/src/components/CleanPlaylist.js"],"names":["React","SpotifyWebApi","spotifyApi","CleanPlaylist","props","state","userId","user","playlistName","name","playlistId","data","ownerId","buttonPressed","loadingData","newPlaylistId","revealUnable","explicitTracks","cleanTracks","noCleanVersions","recTracks","timesClicked","openPlaylist","makeCleanPlaylist","bind","findCleanTrack","getRecommended","unableToAdd","addTrack","owner","id","explicitTracksList","cleanTracksList","getPlaylistTracks","then","response","items","map","item","track","explicit","push","getTracksData","artist","artists","counter","search","searchResult","tracks","itemC","includes","cleanTrack","setState","itemE","length","trackUri","newId","x","uri","createPlaylist","playlistResult","external_urls","spotify","addTracksToPlaylist","addResult","trackId","tracksList","slice","splice","getRecommendations","limit","seed_tracks","recommededResult","itemR","unavalible","index","recommendedTracks","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './CleanPlaylist.css';\nimport SpotifyWebApi from 'spotify-web-api-js';\nconst spotifyApi = new SpotifyWebApi();\n\nclass CleanPlaylist extends React.Component{\n  constructor(props){\n    super(props);\n    this.state = {\n      userId: this.props.user,\n      playlistName: this.props.name,\n      playlistId: this.props.data,\n      ownerId: '',\n      buttonPressed: false,\n      loadingData: false,\n      newPlaylistId: '',\n      revealUnable: false\n    };\n    this.explicitTracks = [];\n    this.cleanTracks = [];\n    this.noCleanVersions = [];\n    this.recTracks = [];\n    this.timesClicked = 1;\n    this.openPlaylist = \"\";\n    this.makeCleanPlaylist = this.makeCleanPlaylist.bind(this)\n    this.findCleanTrack = this.findCleanTrack.bind(this)\n    this.getRecommended = this.getRecommended.bind(this)\n    this.unableToAdd = this.unableToAdd.bind(this)\n    this.addTrack = this.addTrack.bind(this)\n\n\n\n  }\n\n  getTracksData(owner, id){\n    var explicitTracksList = []\n    var cleanTracksList = []\n    spotifyApi.getPlaylistTracks(owner, id)\n      .then((response) => {\n        // console.log(response)\n\n        response.items.map((item) =>{\n          if(item.track.explicit === true){\n            explicitTracksList.push(item.track)\n          }else{\n            cleanTracksList.push(item.track)\n          }\n        })\n      })\n      this.explicitTracks = explicitTracksList\n      this.cleanTracks = cleanTracksList\n\n\n    }\n\n    componentDidMount(){\n      var playlistId = this.props.data\n      var ownerId = this.props.id\n      this.getTracksData(ownerId, playlistId)\n    }\n\n    async findCleanTrack(track){\n      var name = track.name\n      var artist = track.artists[0].name\n      var cleanTrack;\n      var itemC;\n      var counter = 0;\n        let searchResult = await spotifyApi.search('track:'+ '\"' +name+ '\"' + ' artist:'+ '\"'+ artist + '\"' ,['track'])\n        // console.log(searchResult)\n        for (itemC of searchResult.tracks.items){\n          if (itemC.explicit === false){\n            if((itemC.name === name || itemC.name.includes(\"Clean\")) && (itemC.artists[0].name === artist && counter <= 0) ){\n              cleanTrack = itemC\n              counter ++\n            }\n          }\n        }\n        if (counter === 0 ){\n          cleanTrack = null\n        }\n\n        return cleanTrack\n    }\n\n    async makeCleanPlaylist(){\n\n      this.setState({\n        loadingData: true\n      })\n\n      var itemE;\n      for (itemE of this.explicitTracks) {\n        let cleanTrack = await this.findCleanTrack(itemE)\n        // console.log(cleanTrack)\n        if (cleanTrack === null){\n          // console.log(\"couldn't add: \" + itemE.name)\n          this.noCleanVersions.push(itemE)\n        }else{\n          this.cleanTracks.push(cleanTrack)\n          // console.log(\" ADDED: \" + cleanTrack.name)\n        }\n      }\n\n      if (this.noCleanVersions.length > 0){\n        this.recTracks = await this.getRecommended(this.noCleanVersions)\n        // console.log(this.recTracks)\n\n      }\n\n\n\n       var trackUri = [];\n       var newId = '';\n       var x;\n       for (x of this.cleanTracks){\n         trackUri.push(x.uri)\n       }\n        let playlistResult = await spotifyApi.createPlaylist(this.state.userId, {name: this.state.playlistName + \"(Clean)\"})\n        // console.log(playlistResult)\n        this.openPlaylist = playlistResult.external_urls.spotify\n        newId = playlistResult.id\n\n        let addResult = await spotifyApi.addTracksToPlaylist(this.state.userId, newId, trackUri)\n        // console.log(addResult)\n\n        this.setState({\n          newPlaylistId: newId,\n          buttonPressed: true\n        })\n\n    }\n\n    async getRecommended(tracks){\n      var trackId = [];\n      var tracksList = tracks.slice();\n      var recTracks =[];\n\n      if (tracks.length > 5){\n        tracksList.splice(5,tracks.length)\n      }\n\n      tracksList.map((item) => {\n        trackId.push(item.id)\n      })\n\n      let recommededResult = await spotifyApi.getRecommendations({limit: 20, seed_tracks: trackId})\n      // console.log(recommededResult)\n      var itemR;\n\n        for (itemR of recommededResult.tracks) {\n          if (itemR.explicit === true){\n            let cleanTrack = await this.findCleanTrack(itemR)\n              // console.log(cleanTrack)\n            if (cleanTrack !== null){\n              recTracks.push(cleanTrack)\n            }\n\n          }else{\n            recTracks.push(itemR)\n          }\n        }\n\n        if (recTracks.length > 10){\n          recTracks = recTracks.slice(0,10)\n        }\n\n      return recTracks\n    }\n\n   unableToAdd(){\n     this.timesClicked ++\n     if (this.timesClicked % 2 === 0){\n       this.setState({\n         revealUnable: true\n       })\n     }else{\n       this.setState({\n         revealUnable: false\n       })\n     }\n    }\n\n     async addTrack(uri){\n      let addResult = await spotifyApi.addTracksToPlaylist(this.state.userId, this.state.newPlaylistId, [uri])\n      // console.log(addResult)\n    }\n\n  render(){\n\n    const unavalible =\n    this.noCleanVersions.map(function(item, index) {\n      index++\n      return (\n        <p key={item.id}> {index}. {item.name}</p>\n      )\n    });\n\n\n    const recommendedTracks =\n    this.recTracks.map(function(item) {\n      return (\n        <div key= {item.id}>\n        <div className=\"row my-2\">\n          <div className=\"col\">\n            <button type=\"button\" className=\"btn btn-add\" onClick={() => this.addTrack(item.uri)}> ADD </button>\n          </div>\n          <div className=\"col-10\">\n            <iframe src= {\"https://open.spotify.com/embed/track/\" + item.id } width=\"90%\" height=\"80\" frameBorder=\"0\" allowtransparency=\"true\" allow=\"encrypted-media\" title=\"embeded-track\"></iframe>\n          </div>\n        </div>\n        </div>\n      )\n    }, this);\n\n\n\n    return(\n      <div className= \"Clean\">\n\n      {\n        this.state.buttonPressed ?\n        <div className= \"mx-auto\">\n          <h3 className=\"font-weight-bold text-success\"> Your Playlist Is Cleanified! </h3>\n          <p> You're done! We have already saved it to your library!</p>\n            <a href= {this.openPlaylist} target=\"_blank\" className=\"btn btn-success\"> Open In Spotify </a>\n          <div className=\"row\">\n            <div className=\"col\">\n              <iframe src= {\"https://open.spotify.com/embed/playlist/\" + this.state.playlistId} width=\"80%\" height=\"400\" frameBorder=\"0\" allowtransparency=\"true\" allow=\"encrypted-media\" title=\"embeded-playlist\"></iframe>\n            </div>\n            <i className=\"fas fa-arrow-right text-success fa-2x\"></i>\n            <div className=\"col\">\n              <iframe src= {\"https://open.spotify.com/embed/playlist/\" + this.state.newPlaylistId} width=\"80%\" height=\"400\" frameBorder=\"0\" allowtransparency=\"true\" allow=\"encrypted-media\" title=\"embeded-playlist\"></iframe>\n            </div>\n\n          </div>\n          <hr className=\"divider mb-5\"/>\n\n          <div>\n            <button type=\"button\" className=\"btn btn-danger\" onClick={this.unableToAdd}> Reveal Songs Unable to be Cleaned: {this.noCleanVersions.length}</button>\n            {\n              this.state.revealUnable && this.noCleanVersions.length > 0 ?\n                unavalible\n              :\n              this.state.revealUnable &&\n               <p>Good News! We were able to find clean versions of each song!</p>\n            }\n            {\n              this.noCleanVersions.length > 0 &&\n              <div>\n              <hr className=\"divider mt-5\"/>\n              <h2>Recommended Clean Songs</h2>\n              <p>Based on the songs we were unable to add: </p>\n\n                {recommendedTracks}\n              </div>\n            }\n\n\n          </div>\n\n        </div>\n        :\n          <div>\n          <button type=\"button\" className=\"btn btn-lg btn-success\" onClick= {this.makeCleanPlaylist} disabled={this.state.loadingData}>\n          { this.state.loadingData &&\n            <i class=\"fa fa-compact-disc fa-spin text-white\"></i>\n          }\n          Clean Playlist\n          </button>\n\n          <div>\n            <iframe src= {\"https://open.spotify.com/embed/playlist/\" + this.state.playlistId} width=\"80%\" height=\"500\" frameBorder=\"0\" allowtransparency=\"true\" allow=\"encrypted-media\" title=\"embeded-playlist\"></iframe>\n          </div>\n          <p className=\"text-muted\"> Note: Spotify's explicit content tags are applied based on information Spotify receives from rights-holders. They can’t guarantee all explicit content is marked as such.</p>\n          </div>\n      }\n\n      </div>\n    )\n  }\n}\n\nexport default CleanPlaylist\n"]},"metadata":{},"sourceType":"module"}